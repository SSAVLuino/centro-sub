"use client"

import { useState } from "react"
import Link from "next/link"
import { usePathname, useRouter } from "next/navigation"
import { LayoutDashboard, Users, Wind, LogOut, Menu, X, User, FileText, Package, CheckCircle2, Gift } from "lucide-react"
import { createClient } from "@/lib/supabase/client"
import { canAccess } from "@/lib/roles-client"
import type { UserRole } from "@/lib/roles-client"
import { clsx } from "clsx"

const navItems: { href: string; label: string; icon: React.ElementType; minRole?: UserRole }[] = [
  { href: "/dashboard",   label: "Dashboard",        icon: LayoutDashboard },
  { href: "/soci",        label: "Soci",              icon: Users },
  { href: "/compressore", label: "Compressore",       icon: Wind,         minRole: "Staff" },
  { href: "/bombole",     label: "Bombole",           icon: Package,      minRole: "Consiglio" },
  { href: "/revisioni",   label: "Revisioni Bombole", icon: CheckCircle2, minRole: "Consiglio" },
  { href: "/certificati", label: "Certificati",       icon: FileText,     minRole: "Consiglio" },
  { href: "/inventario",  label: "Inventario",        icon: Package,      minRole: "Staff" },
  { href: "/noleggio",    label: "Noleggi",           icon: Gift,         minRole: "Staff" },
  { href: "/piscina",     label: "Piscina",           icon: CheckCircle2 },
  { href: "/profilo",     label: "Profilo",           icon: User },
]

// ── Logo SSAV SVG inline ──────────────────────────────────────────────────
// Riproduce fedelmente il logo: "SSAV" blu + subacqueo rosso con pinne
function SsavLogoIcon({ size = 36 }: { size?: number }) {
  return (
    <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 1491 703" width="150" >
	<g>
	<path d="M 485.00 352.55 C476.77,354.11 437.25,355.36 427.50,354.37 C407.59,352.35 380.23,346.56 368.50,341.88 L 362.50 339.49 L 362.24 306.74 C361.98,274.76 362.02,274.00 363.94,274.00 C365.02,274.00 374.36,275.55 384.70,277.44 C426.96,285.17 446.95,285.92 468.00,280.56 C489.29,275.15 497.32,266.79 490.74,256.90 C486.71,250.86 483.02,249.82 462.13,248.88 C421.95,247.06 404.20,243.92 386.17,235.44 C366.51,226.19 357.15,210.81 353.92,182.47 C351.02,156.88 357.33,140.22 376.92,121.81 C394.76,105.04 415.79,95.92 443.50,92.93 C455.24,91.66 481.47,92.22 497.50,94.08 C516.80,96.31 544.06,102.20 546.52,104.66 C547.77,105.91 548.00,111.36 548.00,139.21 L 548.00 172.27 L 543.25 171.58 C506.82,166.25 479.23,164.33 460.50,165.82 C445.59,167.00 434.84,169.20 430.20,172.02 C420.89,177.68 420.67,190.24 429.80,194.90 C436.05,198.09 444.21,199.04 473.50,200.02 C503.62,201.02 513.82,202.44 525.69,207.28 C552.01,218.02 565.98,243.20 563.51,275.44 C560.32,316.97 533.44,343.37 485.00,352.55 ZM 247.50 352.59 C238.88,354.18 199.90,355.42 191.00,354.39 C166.92,351.61 143.59,346.71 131.50,341.88 L 125.50 339.49 L 125.24 306.74 C124.99,276.03 125.08,274.00 126.74,274.00 C127.71,274.01 137.27,275.59 148.00,277.52 C190.76,285.23 209.90,285.93 231.00,280.56 C252.29,275.15 260.32,266.79 253.74,256.90 C249.71,250.86 246.02,249.82 225.13,248.88 C184.47,247.04 166.90,243.90 149.01,235.29 C129.25,225.78 120.14,210.78 116.92,182.47 C114.02,156.94 120.17,140.48 139.39,122.32 C163.26,99.78 191.19,90.90 233.58,92.38 C254.39,93.11 269.10,94.76 287.50,98.45 C303.29,101.62 309.64,103.61 310.41,105.63 C310.74,106.47 311.00,121.81 311.00,139.72 L 311.00 172.27 L 306.25 171.58 C257.97,164.52 225.06,163.52 203.46,168.46 C191.53,171.18 186.01,176.26 186.00,184.53 C186.00,189.45 187.96,192.43 192.85,194.92 C199.07,198.10 207.34,199.08 235.50,199.99 C252.00,200.52 265.95,201.48 271.36,202.45 C299.54,207.53 317.44,222.86 324.17,247.69 C327.17,258.75 327.15,280.08 324.13,291.50 C315.55,323.95 289.25,344.91 247.50,352.59 ZM 649.99 346.00 L 647.31 355.50 L 618.72 355.77 C603.00,355.91 589.96,355.69 589.74,355.27 C589.53,354.84 608.12,295.55 631.06,223.50 L 672.77 92.50 L 713.91 92.24 C746.31,92.03 755.15,92.25 755.49,93.24 C756.63,96.51 820.70,283.94 832.09,317.33 C839.19,338.13 845.00,355.35 845.00,355.58 C845.00,355.81 831.53,356.00 815.06,356.00 C794.28,356.00 784.91,355.66 784.44,354.90 C784.06,354.29 780.49,342.25 776.51,328.15 L 769.26 302.50 L 662.30 301.98 L 657.48 319.24 C654.83,328.73 651.46,340.77 649.99,346.00 ZM 1057.55 253.00 L 1027.41 355.50 L 988.29 355.76 L 949.17 356.02 L 947.63 351.26 C946.79,348.64 941.38,331.42 935.63,313.00 C929.87,294.58 921.48,267.80 917.00,253.50 C881.94,141.77 867.00,93.95 867.00,93.51 C867.00,93.23 879.81,93.00 895.46,93.00 L 923.92 93.00 L 926.08 100.25 C927.27,104.24 938.73,143.43 951.54,187.34 C964.36,231.25 975.58,267.98 976.47,268.97 C980.27,273.16 992.09,274.04 996.09,270.42 C998.71,268.05 999.83,264.51 1010.05,226.50 C1015.07,207.80 1025.22,170.29 1032.59,143.16 C1039.97,116.02 1046.00,93.63 1046.00,93.41 C1046.00,93.18 1059.20,93.00 1075.32,93.00 L 1104.65 93.00 L 1096.18 121.75 C1091.51,137.56 1074.13,196.62 1057.55,253.00 ZM 686.27 226.74 C685.89,227.73 691.95,228.00 714.89,228.00 C730.90,228.00 744.00,227.64 744.00,227.20 C744.00,226.76 740.40,214.09 736.00,199.06 C731.60,184.03 728.00,171.57 728.00,171.37 C728.00,171.16 722.39,171.00 715.54,171.00 L 703.08 171.00 L 701.66 175.75 C690.38,213.41 686.67,225.70 686.27,226.74 Z" fill="rgb(31,79,148)"/>
	<path d="M 1123.29 703.00 L 373.67 703.00 C579.03,703.00 746.89,702.80 746.89,702.56 C746.65,702.32 738.81,701.64 729.48,701.05 C701.99,699.31 670.67,696.96 668.25,696.44 C665.78,695.92 665.14,694.00 667.43,694.00 C668.22,694.00 669.81,692.68 670.96,691.06 C672.11,689.44 677.21,684.63 682.28,680.38 C687.35,676.14 699.38,665.13 709.00,655.92 C718.62,646.72 728.53,637.51 731.00,635.47 C738.98,628.89 772.32,596.90 778.28,590.09 C781.60,586.31 786.07,579.49 788.78,574.09 C793.42,564.84 793.50,564.54 793.50,555.09 C793.50,548.25 792.96,543.93 791.60,540.05 L 789.70 534.59 L 793.66 531.05 C795.84,529.10 807.27,518.54 819.06,507.59 C887.84,443.73 943.57,392.25 945.73,390.59 C948.57,388.41 956.62,388.29 981.50,390.05 C989.20,390.60 1010.35,391.95 1028.50,393.05 C1046.65,394.15 1071.85,395.71 1084.50,396.52 C1097.15,397.33 1109.89,397.99 1112.80,398.00 C1117.94,398.00 1118.15,397.89 1119.60,394.42 C1120.42,392.45 1126.69,368.27 1133.53,340.67 C1140.37,313.08 1148.20,281.95 1150.93,271.50 C1153.66,261.05 1156.37,249.44 1156.97,245.70 C1157.67,241.31 1158.08,213.41 1158.14,166.96 L 1158.22 95.02 L 1161.86 94.04 C1168.20,92.34 1185.86,88.28 1205.50,83.99 C1215.95,81.71 1234.18,77.67 1246.00,75.02 C1257.82,72.37 1269.39,69.93 1271.70,69.60 L 1275.89 68.99 L 1273.30 74.75 C1271.88,77.91 1270.38,80.95 1269.99,81.50 C1269.59,82.05 1266.42,88.12 1262.96,95.00 C1245.17,130.25 1229.48,159.74 1224.30,167.65 C1218.14,177.05 1215.70,182.02 1214.06,188.52 C1213.50,190.73 1210.11,197.03 1206.51,202.52 C1202.92,208.01 1199.27,214.52 1198.42,217.00 C1197.56,219.48 1194.83,225.73 1192.35,230.91 L 1187.85 240.32 L 1186.84 283.73 C1186.28,307.60 1186.10,328.28 1186.46,329.68 C1187.08,332.18 1187.13,332.20 1189.19,330.36 C1191.38,328.42 1235.69,280.81 1249.30,265.77 C1255.73,258.68 1258.27,254.79 1263.67,243.83 C1271.45,228.03 1296.98,174.59 1316.99,132.25 C1324.85,115.61 1331.69,102.00 1332.19,102.00 C1333.83,102.00 1339.02,105.00 1378.50,128.79 C1420.37,154.02 1435.31,163.63 1434.81,165.00 C1434.64,165.47 1404.35,188.47 1367.50,216.09 C1330.65,243.72 1297.33,268.91 1293.45,272.07 C1283.91,279.83 1275.32,289.28 1274.53,292.89 C1273.85,295.95 1267.99,304.92 1262.72,310.95 C1261.07,312.85 1258.81,316.45 1257.72,318.95 C1256.62,321.45 1246.75,337.23 1235.78,354.00 C1224.81,370.77 1201.44,406.55 1183.84,433.50 C1166.25,460.45 1151.48,482.89 1151.02,483.36 C1150.11,484.29 1109.53,482.40 1045.59,478.46 C1023.64,477.10 997.92,475.70 988.44,475.34 L 971.20 474.69 L 965.85 479.65 C911.41,530.11 844.65,593.01 843.57,594.87 C843.06,595.75 842.06,600.96 841.35,606.46 C839.29,622.31 836.82,626.41 818.08,645.00 C799.09,663.83 776.15,685.41 766.00,693.98 C761.88,697.46 757.84,700.92 757.04,701.66 C755.81,702.78 815.43,703.00 1123.29,703.00 ZM 801.50 503.53 C794.43,507.00 787.32,506.87 779.50,503.12 C769.14,498.16 764.05,490.40 764.03,479.50 L 764.03 479.21 C764.03,477.19 764.02,475.50 764.28,473.86 C765.55,465.79 773.18,458.71 818.32,416.47 C853.66,383.39 857.09,380.49 864.00,377.88 C880.54,371.63 899.35,384.21 900.76,402.45 C901.54,412.64 900.39,413.96 851.00,459.79 C820.12,488.43 804.97,501.82 801.50,503.53 ZM 758.72 597.59 C748.05,600.43 736.07,598.36 724.81,591.74 C708.83,582.35 702.08,557.08 710.70,538.92 C715.26,529.33 719.84,524.67 729.31,519.99 C746.43,511.54 765.11,514.39 778.52,527.50 C792.07,540.76 793.53,559.10 782.48,577.50 C775.85,588.55 768.12,595.09 758.72,597.59 Z" fill="rgb(208,69,62)"/>
	<path d="M 0.00 351.50 L 0.00 0.00 L 745.50 0.00 L 1491.00 0.00 L 1491.00 351.50 L 1491.00 703.00 L 1123.29 703.00 C815.43,703.00 755.81,702.78 757.04,701.66 C757.84,700.92 761.88,697.46 766.00,693.98 C776.15,685.41 799.09,663.83 818.08,645.00 C836.82,626.41 839.29,622.31 841.35,606.46 C842.06,600.96 843.06,595.75 843.57,594.87 C844.65,593.01 911.41,530.11 965.85,479.65 L 971.20 474.69 L 988.44 475.34 C997.92,475.70 1023.64,477.10 1045.59,478.46 C1109.53,482.40 1150.11,484.29 1151.02,483.36 C1151.48,482.89 1166.25,460.45 1183.84,433.50 C1201.44,406.55 1224.81,370.77 1235.78,354.00 C1246.75,337.23 1256.62,321.45 1257.72,318.95 C1258.81,316.45 1261.07,312.85 1262.72,310.95 C1267.99,304.92 1273.85,295.95 1274.53,292.89 C1275.32,289.28 1283.91,279.83 1293.45,272.07 C1297.33,268.91 1330.65,243.72 1367.50,216.09 C1404.35,188.47 1434.64,165.47 1434.81,165.00 C1435.31,163.63 1420.37,154.02 1378.50,128.79 C1339.02,105.00 1333.83,102.00 1332.19,102.00 C1331.69,102.00 1324.85,115.61 1316.99,132.25 C1296.98,174.59 1271.45,228.03 1263.67,243.83 C1258.27,254.79 1255.73,258.68 1249.30,265.77 C1235.69,280.81 1191.38,328.42 1189.19,330.36 C1187.13,332.20 1187.08,332.18 1186.46,329.68 C1186.10,328.28 1186.28,307.60 1186.84,283.73 L 1187.85 240.32 L 1192.35 230.91 C1194.83,225.73 1197.56,219.48 1198.42,217.00 C1199.27,214.52 1202.92,208.01 1206.51,202.52 C1210.11,197.03 1213.50,190.73 1214.06,188.52 C1215.70,182.02 1218.14,177.05 1224.30,167.65 C1229.48,159.74 1245.17,130.25 1262.96,95.00 C1266.42,88.12 1269.59,82.05 1269.99,81.50 C1270.38,80.95 1271.88,77.91 1273.30,74.75 L 1275.89 68.99 L 1271.70 69.60 C1269.39,69.93 1257.82,72.37 1246.00,75.02 C1234.18,77.67 1215.95,81.71 1205.50,83.99 C1185.86,88.28 1168.20,92.34 1161.86,94.04 L 1158.22 95.02 L 1158.14 166.96 C1158.08,213.41 1157.67,241.31 1156.97,245.70 C1156.37,249.44 1153.66,261.05 1150.93,271.50 C1148.20,281.95 1140.37,313.08 1133.53,340.67 C1126.69,368.27 1120.42,392.45 1119.60,394.42 C1118.15,397.89 1117.94,398.00 1112.80,398.00 C1109.89,397.99 1097.15,397.33 1084.50,396.52 C1071.85,395.71 1046.65,394.15 1028.50,393.05 C1010.35,391.95 989.20,390.60 981.50,390.05 C956.62,388.29 948.57,388.41 945.73,390.59 C943.57,392.25 887.84,443.73 819.06,507.59 C807.27,518.54 795.84,529.10 793.66,531.05 L 789.70 534.59 L 791.60 540.05 C792.96,543.93 793.50,548.25 793.50,555.09 C793.50,564.54 793.42,564.84 788.78,574.09 C786.07,579.49 781.60,586.31 778.28,590.09 C772.32,596.90 738.98,628.89 731.00,635.47 C728.53,637.51 718.62,646.72 709.00,655.92 C699.38,665.13 687.35,676.14 682.28,680.38 C677.21,684.63 672.11,689.44 670.96,691.06 C669.81,692.68 668.22,694.00 667.43,694.00 C665.14,694.00 665.78,695.92 668.25,696.44 C670.67,696.96 701.99,699.31 729.48,701.05 C738.81,701.64 746.65,702.32 746.89,702.56 C747.13,702.80 579.18,703.00 373.67,703.00 L 0.00 703.00 L 0.00 351.50 ZM 758.72 597.59 C768.12,595.09 775.85,588.55 782.48,577.50 C793.53,559.10 792.07,540.76 778.52,527.50 C765.11,514.39 746.43,511.54 729.31,519.99 C719.84,524.67 715.26,529.33 710.70,538.92 C702.08,557.08 708.83,582.35 724.81,591.74 C736.07,598.36 748.05,600.43 758.72,597.59 ZM 801.50 503.53 C804.97,501.82 820.12,488.43 851.00,459.79 C900.39,413.96 901.54,412.64 900.76,402.45 C899.35,384.21 880.54,371.63 864.00,377.88 C857.09,380.49 853.66,383.39 818.32,416.47 C763.58,467.70 764.01,467.20 764.03,479.50 C764.05,490.40 769.14,498.16 779.50,503.12 C787.32,506.87 794.43,507.00 801.50,503.53 ZM 649.99 346.00 C651.46,340.77 654.83,328.73 657.48,319.24 L 662.30 301.98 L 715.78 302.24 L 769.26 302.50 L 776.51 328.15 C780.49,342.25 784.06,354.29 784.44,354.90 C784.91,355.66 794.28,356.00 815.06,356.00 C831.53,356.00 845.00,355.81 845.00,355.58 C845.00,355.35 839.19,338.13 832.09,317.33 C820.70,283.94 756.63,96.51 755.49,93.24 C755.15,92.25 746.31,92.03 713.91,92.24 L 672.77 92.50 L 631.06 223.50 C608.12,295.55 589.53,354.84 589.74,355.27 C589.96,355.69 603.00,355.91 618.72,355.77 L 647.31 355.50 L 649.99 346.00 ZM 1057.55 253.00 C1074.13,196.62 1091.51,137.56 1096.18,121.75 L 1104.65 93.00 L 1075.32 93.00 C1059.20,93.00 1046.00,93.18 1046.00,93.41 C1046.00,93.63 1039.97,116.02 1032.59,143.16 C1025.22,170.29 1015.07,207.80 1010.05,226.50 C999.83,264.51 998.71,268.05 996.09,270.42 C992.09,274.04 980.27,273.16 976.47,268.97 C975.58,267.98 964.36,231.25 951.54,187.34 C938.73,143.43 927.27,104.24 926.08,100.25 L 923.92 93.00 L 895.46 93.00 C879.81,93.00 867.00,93.23 867.00,93.51 C867.00,93.95 881.94,141.77 917.00,253.50 C921.48,267.80 929.87,294.58 935.63,313.00 C941.38,331.42 946.79,348.64 947.63,351.26 L 949.17 356.02 L 988.29 355.76 L 1027.41 355.50 L 1057.55 253.00 ZM 247.50 352.59 C289.25,344.91 315.55,323.95 324.13,291.50 C327.15,280.08 327.17,258.75 324.17,247.69 C317.44,222.86 299.54,207.53 271.36,202.45 C265.95,201.48 252.00,200.52 235.50,199.99 C207.34,199.08 199.07,198.10 192.85,194.92 C187.96,192.43 186.00,189.45 186.00,184.53 C186.01,176.26 191.53,171.18 203.46,168.46 C225.06,163.52 257.97,164.52 306.25,171.58 L 311.00 172.27 L 311.00 139.72 C311.00,121.81 310.74,106.47 310.41,105.63 C309.64,103.61 303.29,101.62 287.50,98.45 C269.10,94.76 254.39,93.11 233.58,92.38 C191.19,90.90 163.26,99.78 139.39,122.32 C120.17,140.48 114.02,156.94 116.92,182.47 C120.14,210.78 129.25,225.78 149.01,235.29 C166.90,243.90 184.47,247.04 225.13,248.88 C246.02,249.82 249.71,250.86 253.74,256.90 C260.32,266.79 252.29,275.15 231.00,280.56 C209.90,285.93 190.76,285.23 148.00,277.52 C137.27,275.59 127.71,274.01 126.74,274.00 C125.08,274.00 124.99,276.03 125.24,306.74 L 125.50 339.49 L 131.50 341.88 C143.59,346.71 166.92,351.61 191.00,354.39 C199.90,355.42 238.88,354.18 247.50,352.59 ZM 485.00 352.55 C533.44,343.37 560.32,316.97 563.51,275.44 C565.98,243.20 552.01,218.02 525.69,207.28 C513.82,202.44 503.62,201.02 473.50,200.02 C444.21,199.04 436.05,198.09 429.80,194.90 C420.67,190.24 420.89,177.68 430.20,172.02 C434.84,169.20 445.59,167.00 460.50,165.82 C479.23,164.33 506.82,166.25 543.25,171.58 L 548.00 172.27 L 548.00 139.21 C548.00,111.36 547.77,105.91 546.52,104.66 C544.06,102.20 516.80,96.31 497.50,94.08 C481.47,92.22 455.24,91.66 443.50,92.93 C415.79,95.92 394.76,105.04 376.92,121.81 C357.33,140.22 351.02,156.88 353.92,182.47 C357.15,210.81 366.51,226.19 386.17,235.44 C404.20,243.92 421.95,247.06 462.13,248.88 C483.02,249.82 486.71,250.86 490.74,256.90 C497.32,266.79 489.29,275.15 468.00,280.56 C446.95,285.92 426.96,285.17 384.70,277.44 C374.36,275.55 365.02,274.00 363.94,274.00 C362.02,274.00 361.98,274.76 362.24,306.74 L 362.50 339.49 L 368.50 341.88 C380.23,346.56 407.59,352.35 427.50,354.37 C437.25,355.36 476.77,354.11 485.00,352.55 ZM 686.27 226.74 C686.67,225.70 690.38,213.41 701.66,175.75 L 703.08 171.00 L 715.54 171.00 C722.39,171.00 728.00,171.16 728.00,171.37 C728.00,171.57 731.60,184.03 736.00,199.06 C740.40,214.09 744.00,226.76 744.00,227.20 C744.00,227.64 730.90,228.00 714.89,228.00 C691.95,228.00 685.89,227.73 686.27,226.74 Z" fill="rgb(254,254,254)"/>
	</g>
	</svg>
  )
}

// ── Brand completo sidebar ────────────────────────────────────────────────
function SsavBrand() {
  return (
    <div className="flex items-center gap-3">
      <div className="shrink-0 w-40 h-50 rounded-xl overflow-hidden shadow-sm">
        <SsavLogoIcon size={40} />
      </div>

    </div>
  )
}

// ── Brand compatto mobile ─────────────────────────────────────────────────
function SsavBrandMobile() {
  return (
    <div className="flex items-center gap-2.5">
      <div className="w-8 h-8 rounded-lg overflow-hidden shadow-sm">
        <SsavLogoIcon size={32} />
      </div>
      <span
        className="font-bold text-base tracking-widest"
        style={{ fontFamily: "'Syne', sans-serif", color: "#2B3E9E" }}
      >
        SSAV
      </span>
    </div>
  )
}

export default function Sidebar({ userRole }: { userRole: UserRole }) {
  const pathname = usePathname()
  const router   = useRouter()
  const supabase = createClient()
  const [mobileOpen, setMobileOpen] = useState(false)

  const visibleItems = navItems.filter(item =>
    !item.minRole || canAccess(item.minRole, userRole)
  )

  async function handleLogout() {
    await supabase.auth.signOut()
    router.push("/login")
    router.refresh()
  }

  const NavLinks = ({ onClick }: { onClick?: () => void }) => (
    <>
      {visibleItems.map(({ href, label, icon: Icon }) => {
        const active = pathname.startsWith(href)
        return (
          <Link key={href} href={href} onClick={onClick}
            className={clsx(
              "flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium transition-all",
              active
                ? "ocean-gradient text-white shadow-md"
                : "text-muted-foreground hover:bg-secondary hover:text-foreground"
            )}>
            <Icon className="w-4 h-4 shrink-0" />
            {label}
          </Link>
        )
      })}
    </>
  )

  return (
    <>
      {/* ── DESKTOP sidebar ─────────────────────────────── */}
      <aside className="hidden md:flex w-64 min-h-screen glass border-r border-border flex-col">
        <div className="p-6 border-b border-border">
          <SsavBrand />
        </div>

        <nav className="flex-1 p-4 space-y-1">
          <NavLinks />
        </nav>

        {/* Badge ruolo */}
        <div className="px-4 pb-2">
          <span className="inline-block text-xs bg-primary/10 text-primary px-3 py-1 rounded-full font-medium">
            {userRole}
          </span>
        </div>

        <div className="p-4 border-t border-border">
          <button onClick={handleLogout}
            className="flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium text-muted-foreground hover:bg-destructive/10 hover:text-destructive transition-all w-full">
            <LogOut className="w-4 h-4" /> Esci
          </button>
        </div>
      </aside>

      {/* ── MOBILE topbar ───────────────────────────────── */}
      <div className="md:hidden fixed top-0 left-0 right-0 z-40 glass border-b border-border px-4 py-3 flex items-center justify-between">
        <SsavBrandMobile />
        <button onClick={() => setMobileOpen(v => !v)}
          className="p-2 rounded-xl hover:bg-secondary transition-all">
          {mobileOpen ? <X className="w-5 h-5" /> : <Menu className="w-5 h-5" />}
        </button>
      </div>

      {/* ── MOBILE drawer ───────────────────────────────── */}
      {mobileOpen && (
        <div className="md:hidden fixed inset-0 z-30 flex">
          <div
            className="absolute inset-0 bg-black/30 backdrop-blur-sm"
            onClick={() => setMobileOpen(false)}
          />
          <nav className="relative w-72 max-w-[85vw] bg-white/95 backdrop-blur h-full flex flex-col shadow-2xl">
            <div className="p-6 border-b border-border">
              <SsavBrand />
            </div>
            <div className="flex-1 p-4 space-y-1 overflow-y-auto">
              <NavLinks onClick={() => setMobileOpen(false)} />
            </div>
            <div className="px-4 pb-2">
              <span className="inline-block text-xs bg-primary/10 text-primary px-3 py-1 rounded-full font-medium">
                {userRole}
              </span>
            </div>
            <div className="p-4 border-t border-border">
              <button onClick={handleLogout}
                className="flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium text-muted-foreground hover:bg-destructive/10 hover:text-destructive transition-all w-full">
                <LogOut className="w-4 h-4" /> Esci
              </button>
            </div>
          </nav>
        </div>
      )}
    </>
  )
}

